---
title: "Tidyverse"
author: "Melissa Bowman"
date: "2022-10-28"
output: html_document
---

For the project TidyVerse, an example was created using mostly the dplyr package and the data from a FiveThirtyEight article titled *2022 Is Not Another ‘Year Of The Woman’*  (https://fivethirtyeight.com/features/2022-women-candidates-data/) and its data was located here: https://github.com/fivethirtyeight/data/tree/master/primary-project-2022

Load libraries.
```{r libraries}
library(tidyverse)
```


Reading in the data frames using the **readr** package
```{r pressure, read_csv}
url_republican <- "https://raw.githubusercontent.com/fivethirtyeight/data/master/primary-project-2022/rep_candidates.csv"
url_democratic <-"https://raw.githubusercontent.com/fivethirtyeight/data/master/primary-project-2022/dem_candidates.csv"
df_rep <- read.csv(url_republican)
df_dem <- read.csv(url_democratic) 
```

### Using the dplyr package for the following: <br>

Creating new columns 
```{r}
df_dem <- df_dem %>%
  mutate(political_party = "Democrat")
df_rep <- df_rep %>%
  mutate(political_party = "Republican")
```

Counting unique variable in each column 
```{r}
df_dem %>%
  filter("Gender" != "") %>%
  count(Gender, name  = "Count")
df_rep %>%
  filter("Gender" != "") %>%
  count(Gender, name  = "Count")
```

Combining data frame into one 
```{r}
df_bind <- bind_rows(df_rep, df_dem)
```

Creating a subset of specific columns into a new data frame
```{r}
df_subset_bind <- df_bind %>%
  select(Candidate, 
         Gender, 
         Race.1, 
         Race.2, 
         Race.3, 
         Incumbent, 
         State, 
         Office, 
         District, 
         political_party)
```

# TidyVerse Extension Assignment

by Jen Abinette

## Exploring the ggplot2 package

```{r}
library(ggplot2)
```

### Creating a Bar Plot for gender and political party

```{r}
ggplot(data = df_subset_bind, aes(x = political_party, fill = Gender) ) + geom_bar()
```

### How can this be improved?
In this case, adjusting our scale to a percent rather than a count will better show which political party has more woman as a percent of the whole. Let's also add a title while we are at it using labs.
```{r}
ggplot(data = df_subset_bind, aes(x=political_party,fill=Gender)) + geom_bar(position="fill") + scale_y_continuous(labels = scales::percent) + labs(title="Gender by Political Party")
```

The above plot gives a clear indication to the audience that there is a greater percentage of female candidates in the Democratic Party than Republican.

### Let's explore the count of female candidates by State

```{r}
df_subset_bind_f <- subset(df_subset_bind, Gender == "Female")
ggplot(data = df_subset_bind_f, aes(x = State, fill=Gender)) + geom_bar()
```

### How can we improve the graph above? 
Currently, we are unable to read the State labels given there are so many and the x-axis offers little space.  Thus we can use coord_flip to list the States on the y axis and let's limit our output to the 15 States with the highest count
```{r}
df_subset_bind_f %>% 
  group_by(State) %>%
  summarise(n=n()) %>%  # Summarize by Count
  arrange(desc(n))  %>% # Arrange in descending order
  head(15)%>%           # Show only first 15 States
  # Use reorder to show States in descending order, adjust bar plot default as we have already summarized data and add in steel blue as the bar color, use coord_flip to show State on the y-axis, and label our graph with labs
  ggplot( aes(x = reorder(State, n), y = n) ) +  geom_bar(stat="identity", fill="steelblue") + coord_flip() + labs(title="Top 15 States with Female candidates",
        x ="State", y = "Count")
```

### What about if we also group by Political Party?

```{r}
df_subset_bind_f %>% 
  group_by(State, political_party) %>% # Add political_party
  summarise(n=n()) %>%  
  arrange(desc(n))  %>%
  head(15)%>%
  # Note that as we grouped by State and political party, that head(15) will cause our plot to show the first 15 counts rather than 15 States
  ggplot( aes(x = reorder(State, n), y = n, fill = political_party) ) +  geom_bar(stat="identity") + coord_flip() + labs(title="Top Counts of Female Candidates by State and Political Party",
        x ="State", y = "Count")
```

### These are just a few ways to use the ggplot2 package to visualize results and adjusting plots to better fit our data.